%%% This file contains definitions of various useful macros and environments %%%
%%% Please add more macros here instead of cluttering other files with them. %%%

%%% Minor tweaks of style

% These macros employ a little dirty trick to convince LaTeX to typeset
% chapter headings sanely, without lots of empty space above them.
% Feel free to ignore.
\makeatletter
\def\@makechapterhead#1{
  {\parindent \z@ \raggedright \normalfont
   \Huge\bfseries \thechapter. #1
   \par\nobreak
   \vskip 20\p@
}}
\def\@makeschapterhead#1{
  {\parindent \z@ \raggedright \normalfont
   \Huge\bfseries #1
   \par\nobreak
   \vskip 20\p@
}}
\makeatother

% This macro defines a chapter, which is not numbered, but is included
% in the table of contents.
\def\chapwithtoc#1{
\chapter*{#1}
\addcontentsline{toc}{chapter}{#1}
}

% Draw black "slugs" whenever a line overflows, so that we can spot it easily.
%\overfullrule=1mm

%%% Macros for definitions, theorems, claims, examples, ... (requires amsthm package)

%\theoremstyle{plain}
%\newtheorem{thm}{Theorem}
%\newtheorem{lemma}[thm]{Lemma}
%\newtheorem{claim}[thm]{Claim}
%
%\theoremstyle{plain}
%\newtheorem{defn}{Definition}
%
%\theoremstyle{remark}
%\newtheorem*{cor}{Corollary}
%\newtheorem*{rem}{Remark}
%\newtheorem*{example}{Example}

%%% An environment for proofs

%%% FIXME %%% \newenvironment{proof}{
%%% FIXME %%%   \par\medskip\noindent
%%% FIXME %%%   \textit{Proof}.
%%% FIXME %%% }{
%%% FIXME %%% \newline
%%% FIXME %%% \rightline{$\square$}  % or \SquareCastShadowBottomRight from bbding package
%%% FIXME %%% }

%%% An environment for typesetting of program code and input/output
%%% of programs. (Requires the fancyvrb package -- fancy verbatim.)

\DefineVerbatimEnvironment{code}{Verbatim}{fontsize=\small, frame=single}
\DefineVerbatimEnvironment{shell}{Verbatim}{fontsize=\small, numbers=left,numbersep=3mm,frame=single, framesep=2ex}

%%% The field of all real and natural numbers
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}

%%% Various math goodies
\newcommand{\cdotop}{\mathop{\cdot}}

%%% Code snippets
\CustomVerbatimCommand{\macro}{Verb}{formatcom=\color{darkgreen},fontfamily=lmtt}
\CustomVerbatimCommand{\fnc}{Verb}{formatcom=\color{darkblue},fontfamily=lmtt}
\CustomVerbatimCommand{\struct}{Verb}{formatcom=\color{darkred},fontfamily=lmtt}
\CustomVerbatimCommand{\field}{Verb}{formatcom=\color{darkred},fontfamily=lmtt}

\newcommand{\macrofmt}[1]{\textcolor{darkgreen}{\texttt{#1}}}
\newcommand{\fncfmt}[1]{\textcolor{darkblue}{\texttt{#1}}}
\newcommand{\structfmt}[1]{\textcolor{darkred}{\texttt{#1}}}
\let\fieldfmt\structfmt

\newcommand{\cmd}[1]{\texttt{#1}}
\newcommand{\sw}[1]{\texttt{#1}}

\newcommand{\netdev}{\structfmt{net\_device}}
\newcommand{\skb}{\structfmt{sk\_buff}}

\newcommand{\kernelcommit}[2]{\href{https://git.kernel.org/pub/scm/linux/kernel/git/#1.git/commit/?id=#2}{#2}}
\newcommand{\kerneltag}[2]{\href{https://git.kernel.org/pub/scm/linux/kernel/git/#1.git/commit/?h=#2}{#2}}

\newcommand{\linuxcommit}[1]{\kernelcommit{torvalds/linux}{#1}}
\newcommand{\netnextcommit}[1]{\kernelcommit{davem/net-next}{#1}}

\newcommand{\linuxtag}[1]{\kerneltag{torvalds/linux}{#1}}

\newcommand{\linuxfile}[1]{\href{https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/#1?h=v4.16}{\texttt{#1}}}

% \linuxfnc{file}{line}{fnc}
\newcommand{\linuxfnc}[3]{\href{https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/#1?h=v4.16\#n#2}{\fncfmt{#3}\footnote{Linux kernel~\cite{linux-kernel}, file \texttt{#1}, line #2}}}

% \linuxstruct{file}{line}{struct}
\newcommand{\linuxstruct}[3]{\href{https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/#1?h=v4.16\#n#2}{\structfmt{#3}\footnote{Linux kernel~\cite{linux-kernel}, file \texttt{#1}, line #2}}}

% \ethtoolfile{file}{line}{label}
\newcommand{\ethtoolfile}[3]{\href{https://git.kernel.org/pub/scm/network/ethtool/ethtool.git/tree/#1?h=v4.16\#n#2}{\texttt{#3}}}

